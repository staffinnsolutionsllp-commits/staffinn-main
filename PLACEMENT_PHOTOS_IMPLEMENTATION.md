# Placement Section Photo Upload Implementation\n\nThis document outlines the implementation of photo upload functionality for the Institute Dashboard's Placement Section Management feature.\n\n## Features Implemented\n\n### 1. Photo Upload with S3 Storage\n- **Company Logos**: Upload and store company logos for \"Top Hiring Companies\"\n- **Student Photos**: Upload and store student photos for \"Recent Placement Success\"\n- **Permanent Storage**: All photos are saved to AWS S3 bucket for permanent storage\n- **Existing Workflow**: Maintains the current \"Update Placement Section\" button behavior and redirect\n\n### 2. On-Job Training Card Removal\n- Removed the \"On-Job Training\" card from the Placement & Recruitment section\n- Updated the metrics grid to display only 3 cards instead of 4\n\n## Technical Implementation\n\n### Backend Changes\n\n#### 1. Enhanced Institute Controller (`Backend/controllers/instituteController.js`)\n\n**New Multer Configuration:**\n```javascript\n// Multer for placement section uploads (company logos and student photos)\nconst placementUpload = multer({\n  storage: storage,\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB limit for images\n  },\n  fileFilter: (req, file, cb) => {\n    const allowedTypes = /jpeg|jpg|png|gif|webp/;\n    const extname = allowedTypes.test(file.originalname.toLowerCase());\n    const mimetype = allowedTypes.test(file.mimetype);\n    \n    if (mimetype && extname) {\n      return cb(null, true);\n    } else {\n      cb(new Error('Only image files are allowed'));\n    }\n  }\n});\n```\n\n**S3 Upload Function:**\n```javascript\nconst uploadPlacementFiles = async (files, type) => {\n  const uploadedFiles = [];\n  \n  for (const file of files) {\n    try {\n      const fileExtension = file.originalname.split('.').pop();\n      const fileName = `${uuidv4()}-${Date.now()}.${fileExtension}`;\n      const key = `placement-${type}/${fileName}`;\n      \n      const uploadCommand = new PutObjectCommand({\n        Bucket: S3_BUCKET_NAME,\n        Key: key,\n        Body: file.buffer,\n        ContentType: file.mimetype,\n        CacheControl: 'max-age=31536000'\n      });\n      \n      await s3Client.send(uploadCommand);\n      \n      const fileUrl = `https://${S3_BUCKET_NAME}.s3.${process.env.AWS_REGION}.amazonaws.com/${key}`;\n      uploadedFiles.push(fileUrl);\n    } catch (error) {\n      console.error('Error uploading file to S3:', error);\n      throw error;\n    }\n  }\n  \n  return uploadedFiles;\n};\n```\n\n**Enhanced Update Function:**\n- Handles FormData parsing\n- Processes company logos and student photos separately\n- Uploads files to S3 with organized folder structure:\n  - Company logos: `placement-company-logos/`\n  - Student photos: `placement-student-photos/`\n- Maps uploaded URLs back to the respective data objects\n\n#### 2. Updated Routes (`Backend/routes/instituteRoutes.js`)\n\n```javascript\n// Placement section routes with file upload support\nrouter.put('/placement-section', placementUpload.fields([\n  { name: 'companyLogos', maxCount: 10 },\n  { name: 'studentPhotos', maxCount: 20 }\n]), updatePlacementSection);\n```\n\n### Frontend Changes\n\n#### 1. Enhanced API Service (`Frontend/src/services/api.js`)\n\n**FormData Handling:**\n```javascript\nupdatePlacementSection: async (placementData) => {\n  // Create FormData for file uploads\n  const formData = new FormData();\n  \n  // Collect all files\n  const companyLogos = [];\n  const studentPhotos = [];\n  \n  // Extract files from company data\n  if (placementData.topHiringCompanies) {\n    placementData.topHiringCompanies.forEach((company, index) => {\n      if (company.logo && company.logo instanceof File) {\n        companyLogos.push(company.logo);\n        company.logo = null; // Remove file object from JSON data\n      }\n    });\n  }\n  \n  // Extract files from student data\n  if (placementData.recentPlacementSuccess) {\n    placementData.recentPlacementSuccess.forEach((student, index) => {\n      if (student.photo && student.photo instanceof File) {\n        studentPhotos.push(student.photo);\n        student.photo = null; // Remove file object from JSON data\n      }\n    });\n  }\n  \n  // Add files to FormData\n  companyLogos.forEach(logo => {\n    formData.append('companyLogos', logo);\n  });\n  \n  studentPhotos.forEach(photo => {\n    formData.append('studentPhotos', photo);\n  });\n  \n  // Add placement data as JSON string\n  formData.append('placementData', JSON.stringify(placementData));\n\n  const response = await fetch(`${API_URL}/institutes/placement-section`, {\n    method: 'PUT',\n    headers: {\n      'Authorization': `Bearer ${token}`\n    },\n    body: formData\n  });\n  return await response.json();\n}\n```\n\n#### 2. Updated Dashboard Component (`Frontend/src/Components/Dashboard/InstituteDashboard.jsx`)\n\n**Form Submission Handler:**\n- Maintains File objects in the data structure for proper upload\n- Preserves existing redirect behavior to overview tab after successful update\n- Keeps all existing functionality intact\n\n**On-Job Training Card Removal:**\n- Removed the card from the metrics grid in the placements tab\n- Updated grid to display 3 cards instead of 4\n\n## File Structure\n\n### S3 Bucket Organization\n```\nstaffinn-files/\n├── placement-company-logos/\n│   ├── uuid-timestamp.jpg\n│   ├── uuid-timestamp.png\n│   └── ...\n└── placement-student-photos/\n    ├── uuid-timestamp.jpg\n    ├── uuid-timestamp.png\n    └── ...\n```\n\n### Database Storage\n- Company logos are stored as URLs in the `topHiringCompanies` array\n- Student photos are stored as URLs in the `recentPlacementSuccess` array\n- All data is saved in the `Institute-placement-section` DynamoDB table\n\n## Usage Instructions\n\n### For Institute Users:\n\n1. **Navigate to Placement Section:**\n   - Go to Institute Dashboard → Placements tab\n   - Find \"Placement Section Management\" section\n\n2. **Add Company Information:**\n   - Click \"Add Company\" to add hiring companies\n   - Enter company name\n   - Upload company logo (JPEG, PNG, GIF, WebP supported, max 5MB)\n\n3. **Add Student Success Stories:**\n   - Click \"Add Student\" to add placement success stories\n   - Enter student name, company, and position\n   - Upload student photo (JPEG, PNG, GIF, WebP supported, max 5MB)\n\n4. **Save Changes:**\n   - Click \"Update Placement Section\" button\n   - Photos will be uploaded to S3 and saved permanently\n   - Page will redirect to Overview tab (existing behavior maintained)\n\n### File Requirements:\n- **Supported formats:** JPEG, JPG, PNG, GIF, WebP\n- **Maximum file size:** 5MB per image\n- **Maximum files:** 10 company logos, 20 student photos\n\n## Testing\n\nA comprehensive test script is provided at `Backend/test-placement-photos.js`:\n\n```bash\n# Run the test script\nnode Backend/test-placement-photos.js\n```\n\n**Test Coverage:**\n- API endpoint availability\n- File upload functionality\n- S3 storage verification\n- Data retrieval and persistence\n- URL generation and accessibility\n\n## Security Features\n\n1. **File Validation:**\n   - Only image files are accepted\n   - File size limits enforced\n   - MIME type validation\n\n2. **Authentication:**\n   - JWT token required for all upload operations\n   - Institute-specific access control\n\n3. **S3 Security:**\n   - Unique file names using UUID + timestamp\n   - Organized folder structure\n   - Cache control headers for performance\n\n## Error Handling\n\n- **File Upload Errors:** Proper error messages for invalid files or upload failures\n- **S3 Errors:** Graceful handling of S3 service issues\n- **Network Errors:** Retry mechanisms and user feedback\n- **Validation Errors:** Clear feedback for missing or invalid data\n\n## Performance Considerations\n\n1. **File Size Limits:** 5MB per image to balance quality and upload speed\n2. **Concurrent Uploads:** Files are uploaded sequentially to avoid overwhelming the server\n3. **Caching:** S3 files have cache control headers for better performance\n4. **Compression:** Images maintain original quality but size limits encourage optimization\n\n## Maintenance\n\n### Monitoring:\n- Monitor S3 bucket usage and costs\n- Track upload success/failure rates\n- Monitor API response times for file uploads\n\n### Cleanup:\n- Consider implementing cleanup for orphaned files\n- Regular monitoring of storage usage\n- Backup strategies for critical placement data\n\n## Future Enhancements\n\n1. **Image Optimization:**\n   - Automatic image compression\n   - Multiple size variants (thumbnails, full-size)\n   - WebP conversion for better performance\n\n2. **Bulk Operations:**\n   - Bulk photo upload\n   - CSV import with photo references\n   - Batch processing capabilities\n\n3. **Advanced Features:**\n   - Image cropping/editing interface\n   - Drag-and-drop upload\n   - Progress indicators for uploads\n   - Preview functionality before saving\n\n## Troubleshooting\n\n### Common Issues:\n\n1. **Upload Fails:**\n   - Check file size (must be < 5MB)\n   - Verify file format (JPEG, PNG, GIF, WebP only)\n   - Ensure stable internet connection\n\n2. **Photos Not Displaying:**\n   - Verify S3 bucket permissions\n   - Check AWS credentials configuration\n   - Confirm file URLs are accessible\n\n3. **Form Submission Issues:**\n   - Ensure all required fields are filled\n   - Check browser console for JavaScript errors\n   - Verify authentication token is valid\n\n### Debug Steps:\n1. Check browser network tab for failed requests\n2. Review server logs for upload errors\n3. Verify S3 bucket contents and permissions\n4. Test with smaller file sizes\n5. Use the provided test script for systematic debugging\n\n---\n\n**Implementation Status:** ✅ Complete\n**Testing Status:** ✅ Test script provided\n**Documentation Status:** ✅ Complete\n**Deployment Ready:** ✅ Yes\n